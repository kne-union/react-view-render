{"version":3,"sources":["../../src/Logic/List/index.js","../../src/util.js","../../src/Logic/Context/index.js"],"names":["applyVariable","map","value","empty","className","props","classnames","resource","$item","$index","index","item","variable","escape","WrappedComponent","originProps","useGlobalContext","components","emitter","output","extract","Object","key","extractProps","currentVariable","newProps","target","transformProps","propsValue","parsedPropsValue","name","path","test","dotIndexList","sign","dotIndex","Math","parseVariable","get","functions","parseFunction","funcKey","lib","func","newFunction","Function","others","omit","args","otherContext","content","url","isPlainObject","isValidElement","newTarget","Array","useEffect","contextFunctions","currentFunctions"],"mappings":"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","file":"static/js/27.26a533ab.chunk.js","sourcesContent":["import React, {Children} from 'react';\nimport Context from '../Context';\nimport classnames from 'classnames';\nimport {applyVariable} from '../../util';\n\nconst List = ({resource, map = (value) => value, empty = null, children, className, ...props}) => {\n    return <div {...props}\n                className={classnames(className, 'view-render-list')}>{(resource || []).length === 0 ? empty : (resource || []).map((item, index) => {\n        const props = map({$item: item, $index: index});\n        return Children.map(children, (item) => {\n            if (!item) {\n                return item;\n            }\n            return <Context variable={props}>{children}</Context>;\n        });\n    })}</div>;\n};\n\nexport default applyVariable(List);","import React, {useEffect, isValidElement} from 'react';\nimport {useGlobalContext, Provider} from './context';\nimport Render from './index';\nimport get from 'lodash/get';\nimport isPlainObject from 'lodash/isPlainObject';\nimport omit from 'lodash/omit';\n\nconst escape = (value) => {\n    if (typeof value === 'string' && value.indexOf('\\\\$') === 0) {\n        return value.replace('\\\\$', '$');\n    }\n    return value;\n};\n\nconst parseVariable = (value) => {\n    if (typeof value !== 'string') {\n        return {\n            name: value,\n            path: ''\n        };\n    }\n    if (!/[.\\[]/.test(value)) {\n        return {\n            name: value,\n            path: ''\n        };\n    }\n    const dotIndexList = ['[', '.'].map((sign) => value.indexOf(sign)).filter((index) => index > -1);\n    if (dotIndexList.length === 0) {\n        return {\n            name: value,\n            path: ''\n        };\n    }\n    const dotIndex = Math.min(...dotIndexList);\n    return {\n        name: value.substr(0, dotIndex),\n        path: value.substr(dotIndex).replace(/^\\./, '')\n    };\n};\n\nexport const extractProps = (props = {}) => {\n    const output = {\n        props: {}, extract: {}\n    };\n    Object.keys(props).forEach((key) => {\n        if (key.charAt(0) === '$') {\n            output.extract[key] = props[key];\n        } else {\n            output.props[escape(key)] = props[key];\n        }\n    });\n\n    return output;\n};\n\nexport const applyVariable = (WrappedComponent) => {\n    return (originProps) => {\n        const {variable, functions, components, ...otherContext} = useGlobalContext();\n        const {emitter} = otherContext;\n        const {props, extract} = extractProps(originProps);\n        const currentVariable = Object.assign({}, variable, extract);\n\n        const transformProps = (target) => {\n            if (typeof target === 'string') {\n                const propsValue = target, parsedPropsValue = parseVariable(target);\n                if (currentVariable.hasOwnProperty(propsValue)) {\n                    return currentVariable[propsValue];\n                }\n                if (currentVariable.hasOwnProperty(parsedPropsValue.name)) {\n                    return get(currentVariable[parsedPropsValue.name], parsedPropsValue.path);\n                }\n                if (functions.hasOwnProperty(propsValue)) {\n                    const parseFunction = (funcKey, variable, functions, lib) => {\n                        const func = functions[funcKey];\n                        if (typeof func === 'string') {\n                            return (...args) => {\n                                const newFunction = new Function('args', 'variable', 'functions', 'lib', func);\n                                const others = omit(functions, funcKey), output = {};\n\n                                Object.keys(others).forEach((key) => {\n                                    output[key] = parseFunction(key, variable, others, lib);\n                                });\n\n                                return newFunction(args, variable, output, lib);\n                            }\n                        }\n                        if (typeof func === 'function') {\n                            return func;\n                        }\n                        return;\n                    };\n\n                    return parseFunction(propsValue,currentVariable,functions,otherContext.lib);\n                }\n                if (components.hasOwnProperty(propsValue)) {\n                    if (typeof components[propsValue] === \"object\") {\n                        return <Render content={components[propsValue]} lib={otherContext.lib}\n                                       emitter={otherContext.emitter}/>;\n                    }\n                    if (typeof components[propsValue] === \"string\") {\n                        return <Render url={components[propsValue]} lib={otherContext.lib}\n                                       emitter={otherContext.emitter} {...otherContext.renderProps}/>;\n                    }\n                }\n                return escape(propsValue);\n            }\n            if (isPlainObject(target) && !isValidElement(target)) {\n                const newTarget = {};\n                Object.keys(target).forEach((key) => {\n                    newTarget[key] = transformProps(target[key]);\n                });\n                return newTarget;\n            }\n            if (Array.isArray(target)) {\n                return target.map((item) => {\n                    return transformProps(item);\n                });\n            }\n            return target;\n        };\n\n        const newProps = transformProps(props);\n\n        useEffect(() => {\n            emitter && emitter.emit('component-appended', currentVariable.$id);\n            return () => {\n                emitter && emitter.emit('component-removed', currentVariable.$id);\n            };\n        }, [emitter]);\n        if (Object.keys(extract).length > 0) {\n            return <Provider\n                value={Object.assign({}, otherContext, {functions, components, variable: currentVariable})}>\n                <WrappedComponent {...newProps}/>\n            </Provider>;\n        }\n        return <WrappedComponent {...newProps}/>;\n    };\n};","import React from 'react';\nimport { Provider, useGlobalContext } from '../../context';\nimport { applyVariable } from '../../util';\n\nconst Context = ({ children, functions, variable }) => {\n  const { variable: contextVariable, functions: contextFunctions, ...otherContext } = useGlobalContext();\n  const currentVariable = Object.assign({}, contextVariable, variable);\n  const currentFunctions = Object.assign({}, contextFunctions, functions);\n  return <Provider value={Object.assign({}, otherContext, { variable: currentVariable, functions: currentFunctions })}>\n    {children}\n  </Provider>;\n};\n\nexport default applyVariable(Context);"],"sourceRoot":""}